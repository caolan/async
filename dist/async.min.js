/*global setTimeout: false, console: false */(function(a){function g(){var g={};g.noConflict=function(){return a.async=f,g},typeof process=="undefined"||!process.nextTick?g.nextTick=function(a){setTimeout(a,0)}:g.nextTick=process.nextTick,g.forEach=function(a,c,d){d=d||function(){};if(!a.length)return d();var e=0;b(a,function(b){c(b,function(b){b?(d(b),d=function(){}):(e+=1,e===a.length&&d(null))})})},g.forEachSeries=function(a,b,c){c=c||function(){};if(!a.length)return c();var d=0,e=function(){b(a[d],function(b){b?(c(b),c=function(){}):(d+=1,d===a.length?c(null):e())})};e()},g.forEachLimit=function(a,b,c,d){d=d||function(){};if(!a.length||b<=0)return d();var e=0,f=0,g=0;(function h(){if(e===a.length)return d();while(g<b&&f<a.length)f+=1,g+=1,c(a[f-1],function(b){b?(d(b),d=function(){}):(e+=1,g-=1,e===a.length?d():h())})})()};var h=function(a){return function(){var b=Array.prototype.slice.call(arguments);return a.apply(null,[g.forEach].concat(b))}},i=function(a){return function(){var b=Array.prototype.slice.call(arguments);return a.apply(null,[g.forEachSeries].concat(b))}},j=function(a,b,d,e){var f=[];b=c(b,function(a,b){return{index:b,value:a}}),a(b,function(a,b){d(a.value,function(c,d){f[a.index]=d,b(c)})},function(a){e(a,f)})};g.map=h(j),g.mapSeries=i(j),g.reduce=function(a,b,c,d){g.forEachSeries(a,function(a,d){c(b,a,function(a,c){b=c,d(a)})},function(a){d(a,b)})},g.inject=g.reduce,g.foldl=g.reduce,g.reduceRight=function(a,b,d,e){var f=c(a,function(a){return a}).reverse();g.reduce(f,b,d,e)},g.foldr=g.reduceRight;var k=function(a,b,d,e){var f=[];b=c(b,function(a,b){return{index:b,value:a}}),a(b,function(a,b){d(a.value,function(c){c&&f.push(a),b()})},function(a){e(c(f.sort(function(a,b){return a.index-b.index}),function(a){return a.value}))})};g.filter=h(k),g.filterSeries=i(k),g.select=g.filter,g.selectSeries=g.filterSeries;var l=function(a,b,d,e){var f=[];b=c(b,function(a,b){return{index:b,value:a}}),a(b,function(a,b){d(a.value,function(c){c||f.push(a),b()})},function(a){e(c(f.sort(function(a,b){return a.index-b.index}),function(a){return a.value}))})};g.reject=h(l),g.rejectSeries=i(l);var m=function(a,b,c,d){a(b,function(a,b){c(a,function(c){c?(d(a),d=function(){}):b()})},function(a){d()})};g.detect=h(m),g.detectSeries=i(m),g.some=function(a,b,c){g.forEach(a,function(a,d){b(a,function(a){a&&(c(!0),c=function(){}),d()})},function(a){c(!1)})},g.any=g.some,g.every=function(a,b,c){g.forEach(a,function(a,d){b(a,function(a){a||(c(!1),c=function(){}),d()})},function(a){c(!0)})},g.all=g.every,g.sortBy=function(a,b,d){g.map(a,function(a,c){b(a,function(b,d){b?c(b):c(null,{value:a,criteria:d})})},function(a,b){if(a)return d(a);var e=function(a,b){var c=a.criteria,d=b.criteria;return c<d?-1:c>d?1:0};d(null,c(b.sort(e),function(a){return a.value}))})},g.auto=function(a,c){c=c||function(){};var f=e(a);if(!f.length)return c(null);var g={},h=[],i=function(a){h.unshift(a)},j=function(a){for(var b=0;b<h.length;b+=1)if(h[b]===a){h.splice(b,1);return}},k=function(){b(h.slice(0),function(a){a()})};i(function(){e(g).length===f.length&&(c(null,g),c=function(){})}),b(f,function(b){var e=a[b]instanceof Function?[a[b]]:a[b],f=function(a){if(a)c(a),c=function(){};else{var d=Array.prototype.slice.call(arguments,1);d.length<=1&&(d=d[0]),g[b]=d,k()}},h=e.slice(0,Math.abs(e.length-1))||[],l=function(){return d(h,function(a,b){return a&&g.hasOwnProperty(b)},!0)&&!g.hasOwnProperty(b)};if(l())e[e.length-1](f,g);else{var m=function(){l()&&(j(m),e[e.length-1](f,g))};i(m)}})},g.waterfall=function(a,b){b=b||function(){};if(!a.length)return b();var c=function(a){return function(d){if(d)b(d),b=function(){};else{var e=Array.prototype.slice.call(arguments,1),f=a.next();f?e.push(c(f)):e.push(b),g.nextTick(function(){a.apply(null,e)})}}};c(g.iterator(a))()},g.parallel=function(a,b){b=b||function(){};if(a.constructor===Array)g.map(a,function(a,b){a&&a(function(a){var c=Array.prototype.slice.call(arguments,1);c.length<=1&&(c=c[0]),b.call(null,a,c)})},b);else{var c={};g.forEach(e(a),function(b,d){a[b](function(a){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),c[b]=e,d(a)})},function(a){b(a,c)})}},g.series=function(a,b){b=b||function(){};if(a.constructor===Array)g.mapSeries(a,function(a,b){a&&a(function(a){var c=Array.prototype.slice.call(arguments,1);c.length<=1&&(c=c[0]),b.call(null,a,c)})},b);else{var c={};g.forEachSeries(e(a),function(b,d){a[b](function(a){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),c[b]=e,d(a)})},function(a){b(a,c)})}},g.iterator=function(a){var b=function(c){var d=function(){return a.length&&a[c].apply(null,arguments),d.next()};return d.next=function(){return c<a.length-1?b(c+1):null},d};return b(0)},g.apply=function(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,b.concat(Array.prototype.slice.call(arguments)))}};var n=function(a,b,c,d){var e=[];a(b,function(a,b){c(a,function(a,c){e=e.concat(c||[]),b(a)})},function(a){d(a,e)})};g.concat=h(n),g.concatSeries=i(n),g.whilst=function(a,b,c){a()?b(function(d){if(d)return c(d);g.whilst(a,b,c)}):c()},g.until=function(a,b,c){a()?c():b(function(d){if(d)return c(d);g.until(a,b,c)})},g.queue=function(a,c){var d=0,e={tasks:[],concurrency:c,saturated:null,empty:null,drain:null,push:function(a,d){a.constructor!==Array&&(a=[a]),b(a,function(a){e.tasks.push({data:a,callback:typeof d=="function"?d:null}),e.saturated&&e.tasks.length==c&&e.saturated(),g.nextTick(e.process)})},process:function(){if(d<e.concurrency&&e.tasks.length){var b=e.tasks.shift();e.empty&&e.tasks.length==0&&e.empty(),d+=1,a(b.data,function(){d-=1,b.callback&&b.callback.apply(b,arguments),e.drain&&e.tasks.length+d==0&&e.drain(),e.process()})}},length:function(){return e.tasks.length},running:function(){return d}};return e};var o=function(a){return function(c){var d=Array.prototype.slice.call(arguments,1);c.apply(null,d.concat([function(c){var d=Array.prototype.slice.call(arguments,1);typeof console!="undefined"&&(c?console.error&&console.error(c):console[a]&&b(d,function(b){console[a](b)}))}]))}};return g.log=o("log"),g.dir=o("dir"),g.memoize=function(a,b){var c={},d={};b=b||function(a){return a};var e=function(){var e=Array.prototype.slice.call(arguments),f=e.pop(),g=b.apply(null,e);g in c?f.apply(null,c[g]):g in d?d[g].push(f):(d[g]=[f],a.apply(null,e.concat([function(){c[g]=arguments;var a=d[g];delete d[g];for(var b=0,e=a.length;b<e;b++)a[b].apply(null,arguments)}])))};return e.unmemoized=a,e},g.unmemoize=function(a){return function(){return(a.unmemoized||a).apply(null,arguments)}},g}var b=function(a,b){if(a.forEach)return a.forEach(b);for(var c=0;c<a.length;c+=1)b(a[c],c,a)},c=function(a,c){if(a.map)return a.map(c);var d=[];return b(a,function(a,b,e){d.push(c(a,b,e))}),d},d=function(a,c,d){return a.reduce?a.reduce(c,d):(b(a,function(a,b,e){d=c(d,a,b,e)}),d)},e=function(a){if(Object.keys)return Object.keys(a);var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},f=a.async;typeof define!="undefined"?define([],g):typeof module!="undefined"&&module.exports?module.exports=g():a.async=g()})(this);